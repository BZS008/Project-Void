<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<script src="js/jquery-2.1.0.min.js"></script>	<!--jQuery-->
	<script src="js/jquery.hotkeys.js"></script>		<!--keyboard events-->
	<script src="js/key_status.js"></script>			<!--keyboard events-->
	<script src="js/extra_math.js"></script>			<!--Equations-->
	<script src="js/gamelog.js"></script>
	<script src='js/basicfunctions.js'></script>
	<script src='js/liquid.js'></script>
	<script src='js/animation.js'></script>
	<script src='loadImages.js'></script>
	<script src='js/entitytypes.js'></script>
	
	<script src='js/ai/ai.js'></script>
	<script src='js/ai/neutral1.js'></script>
	
	<script src='js/attack/attack.js'></script>
	<script src='js/attack/LinArDam.js'></script>
	
	<script src='js/initializations.js'></script>
	<script src='js/coords.js'></script>
	<script src='js/viewport.js'></script>
	<script src='js/keyinput.js'></script>
	<script src='js/level.js'></script>
	<script src='js/player.js'></script>
	<link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
	<title>Project Void</title>
</head>

<body bgcolor=#000000>
<center><font color=white face="Verdana","Arial">

<h3>Project Void</h3>

<script>
	"use strict";
	
	// Gametick function
	function gametick(){
		viewport.clear();
		keyinput();
		level.draw();
		liquid.flow();
		
		///// Draw droplets
		var ndrops = liquid.drops.length;
		for(var i=0; i<ndrops; i++){
			liquid.drawDroplet(i);
			var x = xl2xv(liquid.drops[i].vtx[0]);
			var y = yl2yv(liquid.drops[i].vty[0]);
		}
		
		var nents = entities.length;
		for(var i=nents-1;i>-1;i--){
			entities[i].do_ai();
			entities[i].movement();
			entities[i].draw(i);
			
			///// Gamelog /////
			gamelog.textmark(i,entities[i].xview,entities[i].yview);
			///////////////////
			
			//// Show histogram of entity x coordinates
			gamelog.hist[0]={
				oblist: entities,
				prop: 'hp',
				min: -2,
				max: 32
			};
		}
		
		////// All sorts of gamelog stuff
		gamelog.updateGraph(0,gamelog.fps,'fps',30,100); ///// Gamelog!
		gamelog.updateGraph(1,entities.length,'number of entities',0,300);
		if(liquid.drops.length){
			gamelog.updateGraph(2,liquid.drops[0].vtvy[0],'vy droplet',-10,10);
			gamelog.num[3] = liquid.drops[0].vtvy[0];
		}
		gamelog.num[1] = player.cooldown;
		
		var mx = viewport.mousex;
		var my = viewport.mousey;
		var mi = yv2i(my);
		var mj = xv2j(mx);
		var tid = level.data[mi][mj];
		if(tid!==undefined){
			gamelog.textmark('i:'+mi+', j:'+mj, mx, my+40, true);
			gamelog.textmark(tid + ': ' + tileset[tid].name, mx, my+60, true);
			gamelog.textmark(tileset[tid].color, mx, my+80, true);
			
			// Show water properties
			if(tid==4){
				gamelog.textmark("height: " + level.tileprops[mi][mj].height.toPrecision(3),mx,my+100,true);
			}
		}
		
		gamelog.num[2] = liquid.drops.length;
		gamelog.numstr[2] = 'droplets: ';
		//////
		
		gamelog.draw();
		viewport.frametimer();
		viewport.followPlayer();
		
		///// Moet nog netter!!!! ehrmageehrd!!
		if(entities.length<=21){var eid=spawn('enemy1',300,0);entities[eid].vx=2*Math.random()-1;entities[eid].vy=2*Math.random()-1;}
	}
	
	// Define Simulation Loop
	var gameloop = setInterval(function() {
		gametick();
	}, 1000/viewport.goalFPS);
	
	// setTimeout(function(){ clearInterval(gameloop); }, 300);
	
	// Define Canvas
	document.write("<canvas id='spacetime' width=",viewport.width," height=",viewport.height," style='border:1px solid #aaaaaa;'></canvas>");
	var ctx = $("#spacetime").get(0).getContext("2d");	// Create context variable
	$("#spacetime").mousemove('mousemove',function(event){
		viewport.updatemousecoords($("#spacetime")[0],event)
	});

	// Create Game Log object
	var gamelog=createGameLog(ctx);
	//// gamelog.toggle(); // Turn off gamelog
	
</script>

<!-- MOET NOG DYNAMISCH WORDEN GELADEN! -->
<script src='js/tiles/simpletiles.js'></script>
<script src='js/lvl/randlvltest.js'></script>

<span id=extraspace></span>

</font></center>
</body>

</html>
